<!DOCTYPE html>
<html>
<head>
  <title>Distance Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <canvas id="myChart" width="400" height="400"></canvas>
  <script>
    let xCounter = 1;

    const ctx = document.getElementById('myChart').getContext('2d');
    const data = {
      datasets: [{
        label: 'Distance',
        data: [],
        backgroundColor: 'red'
      }]
    };

    const config = {
      type: 'scatter',
      data: data,
      options: {
        scales: {
          x: {
            type: 'linear',
            position: 'bottom',
            title: {
              display: true,
              text: 'X-Axis'
            },
            grid: {
              drawOnChartArea: true,
              color: 'rgba(0, 0, 0, 0.1)',
              lineWidth: 1,
              drawTicks: false,
              tickLength: 0
            },
            ticks: {
              stepSize: 1,
              callback: function(value) { return value; },
              precision: 0
            },
            min: 0
          },
          y: {
            title: {
              display: true,
              text: 'Distance (cm)'
            },
            grid: {
              drawOnChartArea: true,
              color: 'rgba(0, 0, 0, 0.1)',
              lineWidth: 1,
              drawTicks: false,
              tickLength: 0
            },
            ticks: {
              stepSize: 1,
              callback: function(value) { return value; },
              precision: 0
            },
            min: 0
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      }
    };

    const myChart = new Chart(ctx, config);

    function updateAxisLimits(newX, newY) {
      const xScale = myChart.options.scales.x;
      const yScale = myChart.options.scales.y;

      let updated = false;

      if (newX < xScale.min) {
        xScale.min = newX;
        updated = true;
      } else if (newX > xScale.max) {
        xScale.max = newX;
        updated = true;
      }

      if (newY < yScale.min) {
        yScale.min = newY;
        updated = true;
      } else if (newY > yScale.max) {
        yScale.max = newY;
        updated = true;
      }

      if (updated) {
        myChart.update();
      }
    }

    function fetchData() {
  fetch('http://192.168.228.158/distance')
    .then(response => response.json())
    .then(data => {
      const newPoint = { x: xCounter, y: data.distance };
      myChart.data.datasets[0].data.push(newPoint);
      updateAxisLimits(xCounter, data.distance);
      myChart.update();
      xCounter++;
    })
    .catch(error => console.error('Error:', error));
}

setInterval(fetchData, 1000);

  </script>
</body>
</html>
