<!DOCTYPE html>
<html>

<head>
  <title>Sensor Data Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.0.0"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <style>
    .container{
      justify-content: center;
      justify-items: center;

    }
    .root-container {
      height: 100%;
      width: 100%;
    }

    .first-row {
      display: flex;
    }

    .chart-container {
      width: 100%;
      height: 100%;
      border: 2px solid grey;
      margin: 15px;
      padding: 10px;
      border-radius: 8px;
    }

    #threejs-container {
      height: 300px;
      width: 700;
      
    }

    .thermometer {
      height: 100%;
      width: 100%;
    }

    @import url("https://fonts.googleapis.com/css?family=Jaldi&display=swap");

    body {
      display: flex;
      height: 100%;
      width: 100%;
      margin: 0;
      font-family: "Jaldi", sans-serif;
      font-size: 14px;
      color: white;
    }

    #wrapper {
      margin: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    p {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    #info {
      opacity: 0.2;
      margin: 0;
      text-align: center;
    }

    #termometer {
      width: 25px;
      height: 240px;
      position: relative;
      border: 9px solid #2a2a2e;
      border-radius: 20px;
      z-index: 1;
      margin-bottom: 50px;
    }

    #termometer:before,
    #termometer:after {
      position: absolute;
      content: "";
      border-radius: 50%;
    }

    #termometer:before {
      width: 100%;
      height: 34px;
      bottom: 9px;
      background:#feffff;
      z-index: -1;
    }

    #termometer:after {
      transform: translateX(-50%);
      width: 50px;
      height: 50px;
      background-color: #3dcadf;
      bottom: -41px;
      border: 9px solid #2a2a2e;
      z-index: -3;
      left: 50%;
    }

    #termometer #graduations {
      background-color: #fcfcfc;
      height: 59%;
      top: 20%;
      width: 50%;
    }

    #termometer #graduations,
    #termometer #graduations:before {
      position: absolute;
      border-top: 2px solid rgba(0, 0, 0, 0.5);
      border-bottom: 2px solid rgba(0, 0, 0, 0.5);
    }

    #termometer #graduations:before {
      content: "";
      height: 34%;
      width: 100%;
      top: 32%;
    }

    #termometer #temperature {
      bottom: 0;
      background: linear-gradient(#f17a65, #3dcadf) no-repeat bottom;
      width: 100%;
      border-radius: 20px;
      background-size: 100% 240px;
      transition: all 0.2s ease-in-out;
    }

    #termometer #temperature,
    #termometer #temperature:before,
    #termometer #temperature:after {
      position: absolute;
    }

    #termometer #temperature:before {
      content: attr(data-value);
      background: rgba(0, 0, 0, 0.7);
      color: rgb(0, 0, 0);
      z-index: 2;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 1em;
      line-height: 1;
      transform: translateY(50%);
      left: calc(100% + 1em / 1.5);
      top: calc(-1em + 5px - 5px * 2);
    }

    #termometer #temperature:after {
      content: "";
      border-top: 0.4545454545em solid transparent;
      border-bottom: 0.4545454545em solid transparent;
      border-right: 0.6666666667em solid rgba(0, 0, 0, 0.7);
      left: 100%;
      top: calc(-1em / 2.2 + 5px);
    }

    #playground {
      font-size: 1.1em;
    }

    #playground #range {
      display: flex;
    }

    #playground #range input[type=text] {
      width: 2em;
      background: transparent;
      border: none;
      color: inherit;
      font: inherit;
      margin: 0 5px;
      padding: 0px 5px;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease-in-out;
    }

    #playground #range input[type=text]:focus {
      border-color: #3dcadf;
      outline: none;
    }

    #playground #range input[type=text]:first-child {
      text-align: right;
    }

    #playground #unit {
      width: 100%;
      margin: 0;
      text-align: center;
    }

    #playground #unit:hover {
      cursor: pointer;
    }
  </style>

</head>

<body style="display: flex; flex-direction: row; justify-content: center; align-items: center;">
  <div class="container width: 100% ">
    <div class="root-container">
      <div class="first-row">
  
        <div class="chart-container">
          <canvas id="distance-chart"></canvas>
        </div>
  
        <div class="chart-container">
          <canvas id="temp-chart"></canvas>
        </div>
  
        <div class="thermometer">
          <div id="wrapper">
            <div id="termometer">
              <div id="temperature-thermo" style="height:0" data-value="0°C"></div>
              <div id="graduations"></div>
            </div>
          </div>
          <h2 style="color: black; text-align: center;">Temperature</h2>
        </div>
      </div>
  
      <div class="first-row">
  
        <div class="chart-container">
          <canvas id="hmd-chart"></canvas>
        </div>
  
        <div class="thermometer">
          <div id="wrapper">
            <div id="termometer">
              <div id="humidity-thermo" style="height:0" data-value="0%"></div>
              <div id="graduations"></div>
            </div>
          </div>
          <h2 style="color: black; text-align: center;">Humidity</h2>
        </div>
  
        <div id="threejs-container" class="chart-container"></div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/GLTFLoader.js"></script>
      </div>
    </div>
  </div>
  <script>
    let xCounter = 1;

    const distanceCtx = document.getElementById('distance-chart').getContext('2d');
    const tempCtx = document.getElementById('temp-chart').getContext('2d');
    const hmdCtx = document.getElementById('hmd-chart').getContext('2d');

    const distanceData = {
      datasets: [{
        label: 'Distance',
        data: [],
        backgroundColor: 'red',
        borderColor: 'red',
        showLine: true,
        fill: false
      }]
    };

    const tempData = {
      datasets: [{
        label: 'Temperature',
        data: [],
        backgroundColor: 'blue',
        borderColor: 'blue',
        showLine: true,
        fill: false
      }]
    };

    const hmdData = {
      datasets: [{
        label: 'Humidity',
        data: [],
        backgroundColor: 'green',
        borderColor: 'green',
        showLine: true,
        fill: false
      }]
    };

    const config = {
      type: 'line',
      data: distanceData,
      options: {
        scales: {
          x: {
            type: 'linear',
            position: 'bottom',
            title: {
              display: true,
              text: 'Time'
            },
            grid: {
              drawOnChartArea: true,
              color: 'rgba(0, 0, 0, 0.1)',
              lineWidth: 1,
              drawTicks: false,
              tickLength: 0
            },
            ticks: {
              stepSize: 1,
              callback: function (value) { return value; },
              precision: 0,
              autoSkip: true,
              maxRotation: 0,
              minRotation: 0
            },
            beginAtZero: true
          },
          y: {
            beginAtZero: true,
            grid: {
              drawOnChartArea: true,
              color: 'rgba(0, 0, 0, 0.1)',
              lineWidth: 1,
              drawTicks: false,
              tickLength: 0
            }
          }
        },
        plugins: {
          zoom: {
            pan: {
              enabled: true,
              mode: 'x'
            },
            zoom: {
              enabled: true,
              mode: 'x'
            }
          }
        }
      }
    };

    const distanceChart = new Chart(distanceCtx, config);
    const tempChart = new Chart(tempCtx, { ...config, data: tempData });
    const hmdChart = new Chart(hmdCtx, { ...config, data: hmdData });
    let ip = '192.168.0.199';
    function fetchData() {
      fetch(`http://${ip}/distance`)
        .then(response => response.json())
        .then(data => {
          const currentTime = new Date();
          const timeLabel = `${currentTime.getMinutes()}:${currentTime.getSeconds()}`;

          distanceChart.data.labels.push(timeLabel);
          distanceChart.data.datasets[0].data.push({ x: xCounter, y: data.distance });
          distanceChart.update();

          tempChart.data.labels.push(timeLabel);
          tempChart.data.datasets[0].data.push({ x: xCounter, y: data.temperature });
          tempChart.update();

          hmdChart.data.labels.push(timeLabel);
          hmdChart.data.datasets[0].data.push({ x: xCounter, y: data.humidity });
          hmdChart.update();

          xCounter++;

          const tempPercentage = (data.temperature - 20) / 60 * 100;
          const hmdPercentage = data.humidity;
          document.getElementById('temperature-thermo').style.height = `${tempPercentage}%`;
          document.getElementById('temperature-thermo').setAttribute('data-value', `${data.temperature}°C`);

          document.getElementById('humidity-thermo').style.height = `${hmdPercentage}%`;
          document.getElementById('humidity-thermo').setAttribute('data-value', `${data.humidity}%`);

        })
        .catch(error => console.error('Error:', error));
    }

    function fetchTemperature() {
      fetch(`http://${ip}/temperature`)
        .then(response => response.json())
        .then(data => {
          const currentTime = new Date();
          const timeLabel = `${currentTime.getMinutes()}:${currentTime.getSeconds()}`;

          tempChart.data.labels.push(timeLabel);
          tempChart.data.datasets[0].data.push({ x: xCounter, y: data.temperature });
          tempChart.update();

          const tempPercentage = (data.temperature - 20) / 60 * 100;
          document.getElementById('temperature-thermo').style.height = `${tempPercentage}%`;
          document.getElementById('temperature-thermo').setAttribute('data-value', `${data.temperature}°C`);

        })
        .catch(error => console.error('Error:', error));
    }

    function fetchHumidity() {
      fetch(`http://${ip}/temperature`)
        .then(response => response.json())
        .then(data => {
          const currentTime = new Date();
          const timeLabel = `${currentTime.getMinutes()}:${currentTime.getSeconds()}`;

          hmdChart.data.labels.push(timeLabel);
          hmdChart.data.datasets[0].data.push({ x: xCounter, y: data.humidity });
          hmdChart.update();

          const hmdPercentage = data.humidity;
          document.getElementById('humidity-thermo').style.height = `${hmdPercentage}%`;
          document.getElementById('humidity-thermo').setAttribute('data-value', `${data.humidity}%`);

        })
        .catch(error => console.error('Error:', error));
    }

    function initThreeJS() {
            let ax = 0, ay = 0, az = 0;

            const fetchData = () => {
                fetch(`http://${ip}/imu`)
                    .then(response => response.json())
                    .then(data => {
                        ax = data.ax;
                        ay = data.ay;
                        az = data.az;
                    })
                    .catch(error => console.error('Error:', error));
            };

            setInterval(fetchData, 1000); // Fetch data every second

            const container = document.getElementById('threejs-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer();
            renderer.setSize(width, height);
            container.appendChild(renderer.domElement);

            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(1, 1, 1).normalize();
            scene.add(light);

            const loader = new THREE.GLTFLoader();
            let car;
            loader.load('path/to/your/car_model.gltf', function (gltf) {
                car = gltf.scene;
                car.scale.set(1, 1, 1);
                scene.add(car);
            }, undefined, function (error) {
                console.error(error);
            });

            camera.position.z = 5;

            const animate = function () {
                requestAnimationFrame(animate);

                if (car) {
                    car.rotation.x = ax;
                    car.rotation.y = ay;
                    car.rotation.z = az;
                }

                renderer.render(scene, camera);
            };

            animate();
        }




    setInterval(fetchData, 1500);
    setInterval(fetchTemperature, 1500);
    setInterval(fetchHumidity, 1500);

    initThreeJS();
  </script>
</body>

</html>
